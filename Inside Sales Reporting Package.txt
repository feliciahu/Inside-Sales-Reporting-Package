-- CREATE MPB NON ACUTE TABLE
--DROP TABLE SBX_PSAS_DB.SALES_OPS_GOV.V_NON_ACUTE_COMMISSIONS;
CREATE OR REPLACE TABLE SBX_PSAS_DB.SALES_OPS_GOV.V_NON_ACUTE_COMMISSIONS (
CUSTOMER_ID VARCHAR(99),
CUSTOMER_NAME VARCHAR(99),
ASSIGNMENT1 VARCHAR(99),
ASSIGNMENT1_EID VARCHAR(99),
ASSIGNMENT2 VARCHAR(99),
ASSIGNMENT2_EID VARCHAR(99),
IDN VARCHAR(99),
CREATED_DATE VARCHAR(99),
MODIFIED_DATE VARCHAR(99),
MODIFIED_BY VARCHAR(99)
);

--SELECT * FROM SBX_PSAS_DB.SALES_OPS_GOV.V_NON_ACUTE_COMMISSIONS;









--1. SSM
--CPH SSM CUSTOMER COUNT
CREATE OR REPLACE TEMPORARY TABLE SSM_CUST_CNT AS 

SELECT  COUNT(CUST_ACCT_ID) AS CUST_CNT
FROM    PRD_PSAS_ANALYTICS_DB.GOLD_CRM.VW_REP_HIERARCHY
WHERE   REP_GRP_NAME = 'NOT APPLICABLE'
AND     BUS_SGMNT = 'CPH'
AND     ROLE_TYPE = 'SSM'
AND     CURRENT_RECORD_IND = 'Y';


--CPH SSM GROSS PROFIT GOAL BY MONTH
CREATE OR REPLACE TEMPORARY TABLE SSM_GP_GOAL AS 

SELECT  PERIOD_END_DT, 
        SUM(GOAL_VAL) AS GROSS_PROFIT_GOAL
FROM    PRD_PSAS_ANALYTICS_DB.GOLD_DP_SALESOPS.VW_PSAS_SEGMENT_GOAL_ACTLS
WHERE   BUS_SGMNT = 'CPH'
AND     ROLE_TYPE = 'SSM'
AND     METRIC_NAME = 'GROSS PROFIT'
GROUP BY PERIOD_END_DT
ORDER BY PERIOD_END_DT DESC;


--CPH SSM NET SLS ACTUAL BY MONTH
CREATE OR REPLACE TEMPORARY TABLE SSM_NET_SLS AS 

SELECT  PERIOD_END_DT,
        SUM(ACTLS_VAL) AS NET_SLS_ACTUAL
FROM    PRD_PSAS_ANALYTICS_DB.GOLD_DP_SALESOPS.VW_PSAS_SEGMENT_GOAL_ACTLS
WHERE   BUS_SGMNT = 'CPH'
AND     ROLE_TYPE = 'SSM'
AND     METRIC_NAME = 'NET SALES'
GROUP BY PERIOD_END_DT
ORDER BY PERIOD_END_DT DESC;


--CPH SSM GROSS PROFIT ACTUAL BY MONTH
CREATE OR REPLACE TEMPORARY TABLE SSM_GP AS 

SELECT  PERIOD_END_DT,
        SUM(ACTLS_VAL) AS GROSS_PROFIT_ACTUAL
FROM    PRD_PSAS_ANALYTICS_DB.GOLD_DP_SALESOPS.VW_PSAS_SEGMENT_GOAL_ACTLS
WHERE   BUS_SGMNT = 'CPH'
AND     ROLE_TYPE = 'SSM'
AND     METRIC_NAME = 'GROSS PROFIT'
GROUP BY PERIOD_END_DT
ORDER BY PERIOD_END_DT DESC;


--CPH SSM FINAL RESULTS
SELECT  'CPH SSM' TEAM,
        TO_CHAR(SSM_GP_GOAL.PERIOD_END_DT, 'YYYY-MM') AS YR_MONTH,
        SSM_CUST_CNT.CUST_CNT,
        SSM_GP_GOAL.GROSS_PROFIT_GOAL,
        SSM_GP.GROSS_PROFIT_ACTUAL,
        SSM_NET_SLS.NET_SLS_ACTUAL
FROM    SSM_GP_GOAL
LEFT JOIN SSM_GP
ON      SSM_GP.PERIOD_END_DT = SSM_GP_GOAL.PERIOD_END_DT
LEFT JOIN SSM_NET_SLS
ON      SSM_NET_SLS.PERIOD_END_DT = SSM_GP_GOAL.PERIOD_END_DT
CROSS JOIN SSM_CUST_CNT;


--2. ISAM
--CPH ISAM CUSTOMER COUNT
CREATE OR REPLACE TEMPORARY TABLE ISAM_CUST_CNT AS 

SELECT  COUNT(CUST_ACCT_ID) AS CUST_CNT
FROM    PRD_PSAS_ANALYTICS_DB.GOLD_CRM.VW_REP_HIERARCHY
WHERE   REP_GRP_NAME = 'INSIDE SALES TEAM'
AND     BUS_SGMNT = 'CPH'
AND     ROLE_TYPE = 'ISAM'
AND     CURRENT_RECORD_IND = 'Y';


--CPH ISAM GROSS PROFIT GOAL BY MONTH
CREATE OR REPLACE TEMPORARY TABLE ISAM_GP_GOAL AS 

SELECT  PERIOD_END_DT, 
        SUM(GOAL_VAL) AS GROSS_PROFIT_GOAL
FROM    PRD_PSAS_ANALYTICS_DB.GOLD_DP_SALESOPS.VW_ISAM_REP_ACCT_GOAL_ACTLS
WHERE   BUS_SGMNT = 'CPH'
AND     METRIC_NAME = 'GROSS PROFIT'
GROUP BY PERIOD_END_DT
ORDER BY PERIOD_END_DT DESC;


--CPH ISAM NET SLS ACTUAL BY MONTH
CREATE OR REPLACE TEMPORARY TABLE ISAM_NET_SLS AS 

SELECT  PERIOD_END_DT,
        SUM(ACTLS_VAL) AS NET_SLS_ACTUAL
FROM    PRD_PSAS_ANALYTICS_DB.GOLD_DP_SALESOPS.VW_ISAM_REP_ACCT_GOAL_ACTLS
WHERE   BUS_SGMNT = 'CPH'
AND     METRIC_NAME = 'NET SALES'
GROUP BY PERIOD_END_DT
ORDER BY PERIOD_END_DT DESC;


--CPH ISAM GROSS PROFIT ACTUAL BY MONTH
CREATE OR REPLACE TEMPORARY TABLE ISAM_GP AS 

SELECT  PERIOD_END_DT,
        SUM(ACTLS_VAL) AS GROSS_PROFIT_ACTUAL
FROM    PRD_PSAS_ANALYTICS_DB.GOLD_DP_SALESOPS.VW_ISAM_REP_ACCT_GOAL_ACTLS
WHERE   BUS_SGMNT = 'CPH'
AND     METRIC_NAME = 'GROSS PROFIT'
GROUP BY PERIOD_END_DT
ORDER BY PERIOD_END_DT DESC;


--CPH ISAM FINAL RESULTS
SELECT  'CPH ISAM' TEAM,
        TO_CHAR(ISAM_GP_GOAL.PERIOD_END_DT, 'YYYY-MM') AS YR_MONTH,
        ISAM_CUST_CNT.CUST_CNT,
        ISAM_GP_GOAL.GROSS_PROFIT_GOAL,
        ISAM_GP.GROSS_PROFIT_ACTUAL,
        ISAM_NET_SLS.NET_SLS_ACTUAL
FROM    ISAM_GP_GOAL
LEFT JOIN ISAM_GP
ON      ISAM_GP.PERIOD_END_DT = ISAM_GP_GOAL.PERIOD_END_DT
LEFT JOIN ISAM_NET_SLS
ON      ISAM_NET_SLS.PERIOD_END_DT = ISAM_GP_GOAL.PERIOD_END_DT
CROSS JOIN ISAM_CUST_CNT;


--3. SECONDARY GENERIC MANAGER
--CPH SGM CUSTOMER COUNT
CREATE OR REPLACE TEMPORARY TABLE SGM_CUST_CNT AS 

SELECT  COUNT(CUST_ACCT_ID) AS CUST_CNT
FROM    PRD_PSAS_ANALYTICS_DB.GOLD_CRM.VW_REP_HIERARCHY
WHERE   REP_GRP_NAME = 'INSIDE SALES TEAM'
AND     BUS_SGMNT = 'CPH'
AND     ROLE_TYPE = 'SECONDARY OWNER';


--CPH SGM GROSS PROFIT GOAL BY MONTH
CREATE OR REPLACE TEMPORARY TABLE SGM_GP_GOAL AS 

SELECT  PERIOD_END_DT, 
        SUM(GOAL_VAL) AS GROSS_PROFIT_GOAL
FROM    PRD_PSAS_ANALYTICS_DB.GOLD_DP_SALESOPS.VW_PSAS_SEGMENT_GOAL_ACTLS
WHERE   BUS_SGMNT = 'CPH'
AND     ROLE_TYPE = 'SECONDARY OWNER'
AND     METRIC_NAME = 'GROSS PROFIT'
GROUP BY PERIOD_END_DT
ORDER BY PERIOD_END_DT DESC;


--CPH SGM NET SLS ACTUAL BY MONTH
CREATE OR REPLACE TEMPORARY TABLE SGM_NET_SLS AS 

SELECT  PERIOD_END_DT,
        SUM(ACTLS_VAL) AS NET_SLS_ACTUAL
FROM    PRD_PSAS_ANALYTICS_DB.GOLD_DP_SALESOPS.VW_PSAS_SEGMENT_GOAL_ACTLS
WHERE   BUS_SGMNT = 'CPH'
AND     ROLE_TYPE = 'SECONDARY OWNER'
AND     METRIC_NAME = 'NET SALES'
GROUP BY PERIOD_END_DT
ORDER BY PERIOD_END_DT DESC;


--CPH SGM GROSS PROFIT ACTUAL BY MONTH
CREATE OR REPLACE TEMPORARY TABLE SGM_GP AS 

SELECT  PERIOD_END_DT,
        SUM(ACTLS_VAL) AS GROSS_PROFIT_ACTUAL
FROM    PRD_PSAS_ANALYTICS_DB.GOLD_DP_SALESOPS.VW_PSAS_SEGMENT_GOAL_ACTLS
WHERE   BUS_SGMNT = 'CPH'
AND     ROLE_TYPE = 'SECONDARY OWNER'
AND     METRIC_NAME = 'GROSS PROFIT'
GROUP BY PERIOD_END_DT
ORDER BY PERIOD_END_DT DESC;


--CPH SGM FINAL RESULTS
SELECT  'CPH SGM' TEAM,
        TO_CHAR(SGM_GP_GOAL.PERIOD_END_DT, 'YYYY-MM') AS YR_MONTH,
        SGM_CUST_CNT.CUST_CNT,
        SGM_GP_GOAL.GROSS_PROFIT_GOAL,
        SGM_GP.GROSS_PROFIT_ACTUAL,
        SGM_NET_SLS.NET_SLS_ACTUAL
FROM    SGM_GP_GOAL
LEFT JOIN SGM_GP
ON      SGM_GP.PERIOD_END_DT = SGM_GP_GOAL.PERIOD_END_DT
LEFT JOIN SGM_NET_SLS
ON      SGM_NET_SLS.PERIOD_END_DT = SGM_GP_GOAL.PERIOD_END_DT
CROSS JOIN SGM_CUST_CNT;


--4. MPB NON ACUTE
--CPH MPB CUSTOMER COUNT
CREATE OR REPLACE TEMPORARY TABLE MPB_CUST_CNT AS 

SELECT  COUNT(CUST_ACCT_ID) AS CUST_CNT
FROM    PRD_PSAS_ANALYTICS_DB.GOLD_CRM.VW_REP_HIERARCHY
WHERE   REP_GRP_NAME = 'INSIDE SALES TEAM'
AND     BUS_SGMNT = 'MPB NON ACUTE'
AND     ROLE_TYPE = 'SPECIALTY REP'
AND     CURRENT_RECORD_IND = 'Y';


--CPH MPB GROSS PROFIT GOAL BY MONTH
CREATE OR REPLACE TEMPORARY TABLE MPB_GP_GOAL AS 

SELECT  PERIOD_END_DT, 
        SUM(GOAL_VAL) AS GROSS_PROFIT_GOAL
FROM    PRD_PSAS_ANALYTICS_DB.GOLD_DP_SALESOPS.VW_MPB_REP_GOAL_ACTLS
WHERE   BUS_SGMNT = 'MPB NON ACUTE'
AND     METRIC_NAME in ('PLASMA','SPECIALTY')
GROUP BY PERIOD_END_DT
ORDER BY PERIOD_END_DT DESC;


--CPH MPB NET SLS ACTUAL BY MONTH
CREATE OR REPLACE TEMPORARY TABLE MPB_NET_SLS AS 

SELECT  PERIOD_END_DT,
        SUM(ACTLS_VAL) AS NET_SLS_ACTUAL
FROM    PRD_PSAS_ANALYTICS_DB.GOLD_DP_SALESOPS.VW_MPB_REP_GOAL_ACTLS
WHERE   BUS_SGMNT = 'MPB NON ACUTE'
AND     METRIC_NAME = 'NET SALES'
GROUP BY PERIOD_END_DT
ORDER BY PERIOD_END_DT DESC;


--CPH MPB GROSS PROFIT ACTUAL BY MONTH
CREATE OR REPLACE TEMPORARY TABLE MPB_GP AS 

SELECT  PERIOD_END_DT,
        SUM(ACTLS_VAL) AS GROSS_PROFIT_ACTUAL
FROM    PRD_PSAS_ANALYTICS_DB.GOLD_DP_SALESOPS.VW_MPB_REP_GOAL_ACTLS
WHERE   BUS_SGMNT = 'MPB NON ACUTE'
AND     METRIC_NAME = 'GROSS PROFIT'
GROUP BY PERIOD_END_DT
ORDER BY PERIOD_END_DT DESC;


--CPH MPB FINAL RESULTS
SELECT  'CPH MPB' TEAM,
        TO_CHAR(MPB_GP_GOAL.PERIOD_END_DT, 'YYYY-MM') AS YR_MONTH,
        MPB_CUST_CNT.CUST_CNT,
        MPB_GP_GOAL.GROSS_PROFIT_GOAL,
        MPB_GP.GROSS_PROFIT_ACTUAL,
        MPB_NET_SLS.NET_SLS_ACTUAL
FROM    MPB_GP_GOAL
LEFT JOIN MPB_GP
ON      MPB_GP.PERIOD_END_DT = MPB_GP_GOAL.PERIOD_END_DT
LEFT JOIN MPB_NET_SLS
ON      MPB_NET_SLS.PERIOD_END_DT = MPB_GP_GOAL.PERIOD_END_DT
CROSS JOIN MPB_CUST_CNT;


--5. MHS SSM
--MHS SSM CUSTOMER COUNT
CREATE OR REPLACE TEMPORARY TABLE SSM_CUST_CNT_MHS AS 

SELECT  COUNT(CUST_ACCT_ID) AS CUST_CNT
FROM    PRD_PSAS_ANALYTICS_DB.GOLD_CRM.VW_REP_HIERARCHY
WHERE   REP_GRP_NAME = 'NOT APPLICABLE'
AND     BUS_SGMNT = 'MHS'
AND     ROLE_TYPE = 'SSM'
AND     CURRENT_RECORD_IND = 'Y';


--MHS SSM GROSS PROFIT GOAL BY MONTH
CREATE OR REPLACE TEMPORARY TABLE SSM_GP_GOAL_MHS AS 

SELECT  PERIOD_END_DT, 
        SUM(GOAL_VAL) AS GROSS_PROFIT_GOAL
FROM    PRD_PSAS_ANALYTICS_DB.GOLD_DP_SALESOPS.VW_PSAS_SEGMENT_GOAL_ACTLS
WHERE   BUS_SGMNT = 'MHS'
AND     ROLE_TYPE = 'SSM'
AND     METRIC_NAME in ('GROSS PROFIT')
GROUP BY PERIOD_END_DT
ORDER BY PERIOD_END_DT DESC;


--MHS SSM NET SLS ACTUAL BY MONTH
CREATE OR REPLACE TEMPORARY TABLE SSM_NET_SLS_MHS AS 

SELECT  PERIOD_END_DT,
        SUM(ACTLS_VAL) AS NET_SLS_ACTUAL
FROM    PRD_PSAS_ANALYTICS_DB.GOLD_DP_SALESOPS.VW_ISAM_REP_ACCT_GOAL_ACTLS
WHERE   BUS_SGMNT = 'MHS'
AND     METRIC_NAME = 'NET SALES'
GROUP BY PERIOD_END_DT
ORDER BY PERIOD_END_DT DESC;


--MHS SSM GROSS PROFIT ACTUAL BY MONTH
CREATE OR REPLACE TEMPORARY TABLE SSM_GP_MHS AS 

SELECT  PERIOD_END_DT,
        SUM(ACTLS_VAL) AS GROSS_PROFIT_ACTUAL
FROM    PRD_PSAS_ANALYTICS_DB.GOLD_DP_SALESOPS.VW_ISAM_REP_ACCT_GOAL_ACTLS
WHERE   BUS_SGMNT = 'MHS'
AND     METRIC_NAME = 'GROSS PROFIT'
GROUP BY PERIOD_END_DT
ORDER BY PERIOD_END_DT DESC;


--MHS SSM FINAL RESULTS
SELECT  'MHS SSM' TEAM,
        TO_CHAR(SSM_GP_GOAL_MHS.PERIOD_END_DT, 'YYYY-MM') AS YR_MONTH,
        SSM_CUST_CNT_MHS.CUST_CNT,
        SSM_GP_GOAL_MHS.GROSS_PROFIT_GOAL,
        SSM_GP_MHS.GROSS_PROFIT_ACTUAL,
        SSM_NET_SLS_MHS.NET_SLS_ACTUAL
FROM    SSM_GP_GOAL_MHS
LEFT JOIN SSM_GP_MHS
ON      SSM_GP_MHS.PERIOD_END_DT = SSM_GP_GOAL_MHS.PERIOD_END_DT
LEFT JOIN SSM_NET_SLS_MHS
ON      SSM_NET_SLS_MHS.PERIOD_END_DT = SSM_GP_GOAL_MHS.PERIOD_END_DT
CROSS JOIN SSM_CUST_CNT_MHS;


--6. MHS ISAM
--MHS ISAM CUSTOMER COUNT
CREATE OR REPLACE TEMPORARY TABLE ISSM_CUST_CNT_MHS AS 

SELECT  COUNT(CUST_ACCT_ID) AS CUST_CNT
FROM    PRD_PSAS_ANALYTICS_DB.GOLD_CRM.VW_REP_HIERARCHY
WHERE   REP_GRP_NAME = 'INSIDE SALES TEAM'
AND     BUS_SGMNT = 'MHS'
AND     ROLE_TYPE = 'ISAM'
AND     CURRENT_RECORD_IND = 'Y';


--MHS ISAM GROSS PROFIT GOAL BY MONTH
CREATE OR REPLACE TEMPORARY TABLE ISAM_GP_GOAL_MHS AS 

SELECT  PERIOD_END_DT, 
        SUM(GOAL_VAL) AS GROSS_PROFIT_GOAL
FROM    PRD_PSAS_ANALYTICS_DB.GOLD_DP_SALESOPS.VW_ISAM_REP_ACCT_GOAL_ACTLS
WHERE   BUS_SGMNT = 'MHS'
AND     METRIC_NAME in ('GROSS PROFIT')
GROUP BY PERIOD_END_DT
ORDER BY PERIOD_END_DT DESC;


--MHS ISAM NET SLS ACTUAL BY MONTH
CREATE OR REPLACE TEMPORARY TABLE ISAM_NET_SLS_MHS AS 

SELECT  PERIOD_END_DT,
        SUM(ACTLS_VAL) AS NET_SLS_ACTUAL
FROM    PRD_PSAS_ANALYTICS_DB.GOLD_DP_SALESOPS.VW_ISAM_REP_ACCT_GOAL_ACTLS
WHERE   BUS_SGMNT = 'MHS'
AND     METRIC_NAME = 'NET SALES'
GROUP BY PERIOD_END_DT
ORDER BY PERIOD_END_DT DESC;


--MHS ISAM GROSS PROFIT ACTUAL BY MONTH
CREATE OR REPLACE TEMPORARY TABLE ISAM_GP_MHS AS 

SELECT  PERIOD_END_DT,
        SUM(ACTLS_VAL) AS GROSS_PROFIT_ACTUAL
FROM    PRD_PSAS_ANALYTICS_DB.GOLD_DP_SALESOPS.VW_ISAM_REP_ACCT_GOAL_ACTLS
WHERE   BUS_SGMNT = 'MHS'
AND     METRIC_NAME = 'GROSS PROFIT'
GROUP BY PERIOD_END_DT
ORDER BY PERIOD_END_DT DESC;


--MHS ISAM FINAL RESULTS
SELECT  'MHS ISAM' TEAM,
        TO_CHAR(ISAM_GP_GOAL_MHS.PERIOD_END_DT, 'YYYY-MM') AS YR_MONTH,
        ISAM_CUST_CNT_MHS.CUST_CNT,
        ISAM_GP_GOAL_MHS.GROSS_PROFIT_GOAL,
        ISAM_GP_MHS.GROSS_PROFIT_ACTUAL,
        ISAM_NET_SLS_MHS.NET_SLS_ACTUAL
FROM    ISAM_GP_GOAL_MHS
LEFT JOIN ISAM_GP_MHS
ON      ISAM_GP_MHS.PERIOD_END_DT = ISAM_GP_GOAL_MHS.PERIOD_END_DT
LEFT JOIN ISAM_NET_SLS_MHS
ON      ISAM_NET_SLS_MHS.PERIOD_END_DT = ISAM_GP_GOAL_MHS.PERIOD_END_DT
CROSS JOIN ISAM_CUST_CNT_MHS;


--7. MHS MPB
--MHS MPB CUSTOMER COUNT
CREATE OR REPLACE TEMPORARY TABLE MPB_CUST_CNT_MHS AS 

SELECT  COUNT(CUST_ACCT_ID) AS CUST_CNT
FROM    PRD_PSAS_ANALYTICS_DB.GOLD_CRM.VW_REP_HIERARCHY
WHERE   REP_GRP_NAME = 'INSIDE SALES TEAM'
AND     BUS_SGMNT = 'MPB ACUTE'
AND     ROLE_TYPE = 'SPECIALTY REP'
AND     CURRENT_RECORD_IND = 'Y';


--MHS MPB GROSS PROFIT GOAL BY MONTH
CREATE OR REPLACE TEMPORARY TABLE MPB_GP_GOAL_MHS AS 

SELECT  PERIOD_END_DT, 
        SUM(GOAL_VAL) AS GROSS_PROFIT_GOAL
FROM    PRD_PSAS_ANALYTICS_DB.GOLD_DP_SALESOPS.VW_MPB_REP_GOAL_ACTLS
WHERE   BUS_SGMNT = 'MPB NON ACUTE'
AND     METRIC_NAME in ('NEW PRODUCT LAUNCH ACHIEVEMENT','LEAKAGE RECAPTURE ACHIEVEMENT')
GROUP BY PERIOD_END_DT
ORDER BY PERIOD_END_DT DESC;


--MHS MPB NET SLS ACTUAL BY MONTH
CREATE OR REPLACE TEMPORARY TABLE MPB_NET_SLS_MHS AS 

SELECT  PERIOD_END_DT,
        SUM(ACTLS_VAL) AS NET_SLS_ACTUAL
FROM    PRD_PSAS_ANALYTICS_DB.GOLD_DP_SALESOPS.VW_MPB_REP_GOAL_ACTLS
WHERE   BUS_SGMNT = 'MPB NON ACUTE'
AND     METRIC_NAME = 'NET SALES'
GROUP BY PERIOD_END_DT
ORDER BY PERIOD_END_DT DESC;


--MHS MPB GROSS PROFIT ACTUAL BY MONTH
CREATE OR REPLACE TEMPORARY TABLE MPB_GP_MHS AS 

SELECT  PERIOD_END_DT,
        SUM(ACTLS_VAL) AS GROSS_PROFIT_ACTUAL
FROM    PRD_PSAS_ANALYTICS_DB.GOLD_DP_SALESOPS.VW_MPB_REP_GOAL_ACTLS
WHERE   BUS_SGMNT = 'MPB NON ACUTE'
AND     METRIC_NAME = 'GROSS PROFIT'
GROUP BY PERIOD_END_DT
ORDER BY PERIOD_END_DT DESC;


--MHS MPB FINAL RESULTS
SELECT  'MHS MPB' TEAM,
        TO_CHAR(MPB_GP_GOAL_MHS.PERIOD_END_DT, 'YYYY-MM') AS YR_MONTH,
        MPB_CUST_CNT_MHS.CUST_CNT,
        MPB_GP_GOAL_MHS.GROSS_PROFIT_GOAL,
        MPB_GP_MHS.GROSS_PROFIT_ACTUAL,
        MPB_NET_SLS_MHS.NET_SLS_ACTUAL
FROM    MPB_GP_GOAL_MHS
LEFT JOIN MPB_GP_MHS
ON      MPB_GP_MHS.PERIOD_END_DT = MPB_GP_GOAL_MHS.PERIOD_END_DT
LEFT JOIN MPB_NET_SLS_MHS
ON      MPB_NET_SLS_MHS.PERIOD_END_DT = MPB_GP_GOAL_MHS.PERIOD_END_DT
CROSS JOIN MPB_CUST_CNT_MHS;


--8. MASTERS
--MASTERS CUSTOMER COUNT
CREATE OR REPLACE TEMPORARY TABLE MASTERS_CUST_CNT AS 

SELECT  COUNT(CUST_ACCT_ID) AS CUST_CNT
FROM    PRD_PSAS_ANALYTICS_DB.GOLD_CRM.VW_REP_HIERARCHY
WHERE   REP_GRP_NAME = 'INSIDE SALES TEAM'
AND     BUS_SGMNT = 'MASTERS'
AND     ROLE_TYPE = 'ACCOUNT OWNER'
AND     CURRENT_RECORD_IND = 'Y';


--MASTERS GROSS PROFIT GOAL BY MONTH
CREATE OR REPLACE TEMPORARY TABLE MASTERS_GP_GOAL AS 

SELECT  PERIOD_END_DT, 
        SUM(GOAL_VAL) AS GROSS_PROFIT_GOAL
FROM    PRD_PSAS_ANALYTICS_DB.GOLD_DP_SALESOPS.VW_PSAS_SEGMENT_GOAL_ACTLS
WHERE   BUS_SGMNT = 'MASTERS'
AND     ROLE_TYPE = 'ACCOUNT OWNER'
GROUP BY PERIOD_END_DT
ORDER BY PERIOD_END_DT DESC;


--MASTERS NET SLS ACTUAL BY MONTH
CREATE OR REPLACE TEMPORARY TABLE MASTERS_NET_SLS AS 

SELECT  PERIOD_END_DT,
        SUM(ACTLS_VAL) AS NET_SLS_ACTUAL
FROM    PRD_PSAS_ANALYTICS_DB.GOLD_DP_SALESOPS.VW_PSAS_SEGMENT_GOAL_ACTLS
WHERE   BUS_SGMNT = 'MASTERS'
AND     ROLE_TYPE = 'ACCOUNT OWNER'
AND     METRIC_NAME = 'NET REVENUE'
GROUP BY PERIOD_END_DT
ORDER BY PERIOD_END_DT DESC;


--MASTERS GROSS PROFIT ACTUAL BY MONTH
CREATE OR REPLACE TEMPORARY TABLE MASTERS_GP AS 

SELECT  PERIOD_END_DT,
        SUM(ACTLS_VAL) AS GROSS_PROFIT_ACTUAL
FROM    PRD_PSAS_ANALYTICS_DB.GOLD_DP_SALESOPS.VW_PSAS_SEGMENT_GOAL_ACTLS
WHERE   BUS_SGMNT = 'MASTERS'
AND     ROLE_TYPE = 'ACCOUNT OWNER'
AND     METRIC_NAME = 'GROSS PROFIT'
GROUP BY PERIOD_END_DT
ORDER BY PERIOD_END_DT DESC;


--MASTERS FINAL RESULTS
SELECT  'MASTERS' TEAM,
        TO_CHAR(MASTERS_GP_GOAL.PERIOD_END_DT, 'YYYY-MM') AS YR_MONTH,
        MASTERS_CUST_CNT.CUST_CNT,
        MASTERS_GP_GOAL.GROSS_PROFIT_GOAL,
        MASTERS_GP.GROSS_PROFIT_ACTUAL,
        MASTERS_NET_SLS.NET_SLS_ACTUAL
FROM    MASTERS_GP_GOAL
LEFT JOIN MASTERS_GP
ON      MASTERS_GP.PERIOD_END_DT = MASTERS_GP_GOAL.PERIOD_END_DT
LEFT JOIN MASTERSNET_SLS
ON      MASTERS_NET_SLS.PERIOD_END_DT = MASTERS_GP_GOAL.PERIOD_END_DT
CROSS JOIN MASTERS_CUST_CNT;


--TO DO
-- consolidate all groups into one final table after figuring out how to create a table between schemas
-- create tableau dashboard, show to Josh and Eric